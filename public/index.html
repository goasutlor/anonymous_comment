<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASC3 & ATF Job Promotion & Enlargement Pitching - Anonymous Board</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Sarabun', 'Segoe UI', sans-serif;
      max-width: 720px;
      margin: 0 auto;
      padding: 24px;
      background: #f5f0eb;
      color: #1a1a1a;
      line-height: 1.5;
    }
    h1 {
      font-size: 1.35rem;
      font-weight: 700;
      color: #2c1810;
      margin: 0 0 8px 0;
      border-bottom: 2px solid #8b6914;
      padding-bottom: 8px;
    }
    .subtitle { font-size: 0.9rem; color: #555; margin-bottom: 20px; }
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 10px;
    }
    .toolbar button, .toolbar select {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fafafa;
      cursor: pointer;
      font-size: 14px;
    }
    .toolbar button:hover { background: #eee; }
    .toolbar select { min-width: 80px; }
    #editor {
      min-height: 120px;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
      margin-bottom: 10px;
      outline: none;
      font-size: 15px;
    }
    #editor:empty::before { content: '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...'; color: #999; }
    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 600;
    }
    .btn-preview { background: #e8e4dc; color: #333; }
    .btn-submit { background: #8b6914; color: #fff; }
    .btn-preview:hover { background: #ddd; }
    .btn-submit:hover { background: #6d5210; }
    #previewBox {
      display: none;
      margin-top: 12px;
      padding: 14px;
      border: 1px dashed #8b6914;
      border-radius: 8px;
      background: #fdfcf9;
      min-height: 40px;
    }
    #previewBox.show { display: block; }
    .post {
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      border-left: 4px solid #8b6914;
    }
    .post-content {
      margin-bottom: 12px;
      word-break: break-word;
      font-size: 15px;
    }
    .post-content p { margin: 0 0 6px 0; }
    .post-meta { font-size: 12px; color: #777; }
    .empty-msg { color: #888; text-align: center; padding: 24px; }
    .post-actions { margin-top: 10px; }
    .post-actions .post-btn {
      padding: 4px 10px;
      font-size: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #f5f5f5;
      cursor: pointer;
      margin-right: 6px;
    }
    .post-actions .post-btn.edit-btn:hover { background: #e3f2fd; border-color: #1565c0; color: #1565c0; }
    .post-actions .post-btn.del-btn:hover { background: #ffebee; border-color: #c62828; color: #c62828; }
    .post-reactions { margin-top: 10px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .react-btn {
      padding: 4px 10px;
      font-size: 13px;
      border-radius: 20px;
      border: 1px solid #ddd;
      background: #f5f5f5;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .react-btn:hover { background: #eee; }
    .react-btn.like-btn.active { background: #e3f2fd; border-color: #1976d2; color: #1976d2; }
    .react-btn.love-btn.active { background: #fce4ec; border-color: #c2185b; color: #c2185b; }
    .load-err { color: #c62828; padding: 8px 0; font-size: 14px; }
    .clear-section {
      margin-top: 32px;
      padding: 16px;
      background: #f8f6f0;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    .clear-section h3 { font-size: 0.95rem; margin: 0 0 10px 0; color: #555; }
    .clear-section input { padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; width: 200px; margin-right: 8px; }
    .clear-section .btn-clear { background: #8b6914; color: #fff; padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; }
    .clear-section .btn-clear:hover { background: #6d5210; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <h1>ASC3 & ATF Job Promotion & Enlargement Pitching</h1>
  <p class="subtitle">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô / Feedback ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô ‚Äî ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÇ‡∏û‡∏™‡∏ï‡πå</p>

  <div class="card">
    <div class="toolbar">
      <button type="button" data-cmd="bold" title="‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤">B</button>
      <button type="button" data-cmd="italic" title="‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏µ‡∏¢‡∏á">I</button>
      <button type="button" data-cmd="underline" title="‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ">U</button>
      <select data-cmd="fontSize" title="‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£">
        <option value="">‡∏Ç‡∏ô‡∏≤‡∏î</option>
        <option value="1">‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å</option>
        <option value="2">‡πÄ‡∏•‡πá‡∏Å</option>
        <option value="3">‡∏õ‡∏Å‡∏ï‡∏¥</option>
        <option value="4">‡πÉ‡∏´‡∏ç‡πà</option>
        <option value="5">‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å</option>
      </select>
      <select data-cmd="foreColor" title="‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£">
        <option value="">‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</option>
        <option value="#000000">‡∏î‡∏≥</option>
        <option value="#c62828">‡πÅ‡∏î‡∏á</option>
        <option value="#1565c0">‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô</option>
        <option value="#2e7d32">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</option>
        <option value="#6a1b9a">‡∏°‡πà‡∏ß‡∏á</option>
        <option value="#e65100">‡∏™‡πâ‡∏°</option>
      </select>
      <select data-cmd="hiliteColor" title="‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á">
        <option value="">‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå</option>
        <option value="#fff59d">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</option>
        <option value="#c8e6c9">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô</option>
        <option value="#bbdefb">‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô</option>
      </select>
    </div>
    <div id="editor" contenteditable="true"></div>
    <div class="actions" id="submitActions">
      <button type="button" class="btn btn-preview" id="btnPreview">‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
      <button type="button" class="btn btn-submit" id="btnSubmit">‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô</button>
      <button type="button" class="btn btn-preview" id="btnSaveEdit" style="display:none;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      <button type="button" class="btn btn-preview" id="btnCancelEdit" style="display:none;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
    <div id="previewBox" aria-live="polite"></div>
  </div>

  <h2 style="font-size:1.1rem; margin-bottom:10px;">‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô (‡πÇ‡∏û‡∏™‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î)</h2>
  <div id="posts"></div>

  <div class="clear-section">
    <h3>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•: ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
    <input type="password" id="clearSecret" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" autocomplete="off" />
    <button type="button" class="btn-clear" id="btnClear">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
    <p style="margin:10px 0 0 0; font-size:12px; color:#777;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CLEAR_SECRET ‡πÉ‡∏ô Railway (‡∏´‡∏£‡∏∑‡∏≠ .env) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</p>
  </div>

  <script>
    (function () {
      const SESSION_TOKEN_KEY = 'asc3_session_token';

      function getSessionToken() {
        var token = sessionStorage.getItem(SESSION_TOKEN_KEY);
        if (!token) {
          token = 't_' + Date.now() + '_' + Math.random().toString(36).slice(2, 11);
          sessionStorage.setItem(SESSION_TOKEN_KEY, token);
        }
        return token;
      }

      function api(path, opts) {
        return fetch(path, opts).then(function (r) {
          if (!r.ok) throw new Error(r.status + ' ' + r.statusText);
          var ct = r.headers.get('content-type');
          if (ct && ct.indexOf('application/json') !== -1) return r.json();
          return r.text();
        });
      }

      var editor = document.getElementById('editor');
      var previewBox = document.getElementById('previewBox');
      var postsEl = document.getElementById('posts');
      var btnPreview = document.getElementById('btnPreview');
      var btnSubmit = document.getElementById('btnSubmit');
      var btnVoteAgree = document.getElementById('btnVoteAgree');
      var btnVoteDisagree = document.getElementById('btnVoteDisagree');
      var countAgree = document.getElementById('countAgree');
      var countDisagree = document.getElementById('countDisagree');
      var resultAgree = document.getElementById('resultAgree');
      var resultDisagree = document.getElementById('resultDisagree');
      var barAgree = document.getElementById('barAgree');
      var barDisagree = document.getElementById('barDisagree');
      var voteDoneMsg = document.getElementById('voteDoneMsg');
      var btnSaveEdit = document.getElementById('btnSaveEdit');
      var btnCancelEdit = document.getElementById('btnCancelEdit');
      var editingPostId = null;

      function renderTopicVote(v, myVote) {
        v = v || { agree: 0, disagree: 0 };
        myVote = myVote || null;
        var total = v.agree + v.disagree;
        var agreePct = total > 0 ? (v.agree / total) * 100 : 50;
        var disagreePct = total > 0 ? (v.disagree / total) * 100 : 50;
        countAgree.textContent = '(' + v.agree + ')';
        countDisagree.textContent = '(' + v.disagree + ')';
        if (resultAgree) resultAgree.textContent = v.agree;
        if (resultDisagree) resultDisagree.textContent = v.disagree;
        if (barAgree) barAgree.style.width = agreePct + '%';
        if (barDisagree) barDisagree.style.width = disagreePct + '%';
        btnVoteAgree.disabled = false;
        btnVoteDisagree.disabled = false;
        if (myVote === 'agree') {
          btnVoteAgree.classList.add('voted');
          btnVoteDisagree.classList.remove('voted');
          voteDoneMsg.style.display = 'block';
          voteDoneMsg.textContent = '‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß: ‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢ (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)';
        } else if (myVote === 'disagree') {
          btnVoteDisagree.classList.add('voted');
          btnVoteAgree.classList.remove('voted');
          voteDoneMsg.style.display = 'block';
          voteDoneMsg.textContent = '‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß: ‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢ (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)';
        } else {
          btnVoteAgree.classList.remove('voted');
          btnVoteDisagree.classList.remove('voted');
          voteDoneMsg.style.display = 'none';
        }
      }

      function loadVote() {
        var token = getSessionToken();
        return api('/api/vote?token=' + encodeURIComponent(token))
          .then(function (data) {
            renderTopicVote(data, data.myVote);
          })
          .catch(function (e) {
            postsEl.innerHTML = '<p class="load-err">‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + e.message + '</p>';
          });
      }

      function doTopicVote(type) {
        var token = getSessionToken();
        api('/api/vote', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ authorToken: token, choice: type })
        }).then(function () { return loadVote(); }).catch(function (e) { alert('‡πÇ‡∏´‡∏ß‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + e.message); });
      }

      btnVoteAgree.addEventListener('click', function () { doTopicVote('agree'); });
      btnVoteDisagree.addEventListener('click', function () { doTopicVote('disagree'); });

      document.querySelectorAll('.toolbar [data-cmd]').forEach(function (el) {
        el.addEventListener('click', function () {
          var cmd = this.dataset.cmd;
          if (cmd) document.execCommand(cmd, false, null);
          editor.focus();
        });
      });
      document.querySelectorAll('.toolbar select[data-cmd]').forEach(function (el) {
        el.addEventListener('change', function () {
          var cmd = this.dataset.cmd;
          var value = this.value;
          if (cmd && value) document.execCommand(cmd, false, value);
          this.selectedIndex = 0;
          editor.focus();
        });
      });

      btnPreview.addEventListener('click', function () {
        var html = editor.innerHTML.trim();
        if (!html) previewBox.innerHTML = '<em>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</em>';
        else previewBox.innerHTML = html;
        previewBox.classList.add('show');
      });

      function addPost(html) {
        var token = getSessionToken();
        api('/api/posts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content: html, authorToken: token })
        }).then(function () {
          editor.innerHTML = '';
          previewBox.classList.remove('show');
          cancelEditMode();
          loadPosts();
        }).catch(function (e) { alert('‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + e.message); });
      }

      function cancelEditMode() {
        editingPostId = null;
        editor.innerHTML = '';
        previewBox.classList.remove('show');
        btnSubmit.style.display = '';
        btnPreview.style.display = '';
        btnSaveEdit.style.display = 'none';
        btnCancelEdit.style.display = 'none';
      }

      function startEditMode(postId, posts) {
        var p = posts.find(function (x) { return x.id === postId; });
        if (!p || p.authorToken !== getSessionToken()) return;
        editingPostId = postId;
        editor.innerHTML = p.content;
        btnSubmit.style.display = 'none';
        btnPreview.style.display = 'none';
        btnSaveEdit.style.display = '';
        btnCancelEdit.style.display = '';
      }

      function saveEdit() {
        if (!editingPostId) return;
        var html = editor.innerHTML.trim().replace(/^<p><br><\/p>$/i, '').replace(/<p><br><\/p>$/i, '');
        if (!html) return;
        var token = getSessionToken();
        api('/api/posts/' + editingPostId, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content: html, authorToken: token })
        }).then(function () {
          cancelEditMode();
          loadPosts();
        }).catch(function (e) { alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + e.message); });
      }

      function deletePost(postId) {
        if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ô‡∏µ‡πâ?')) return;
        var token = getSessionToken();
        api('/api/posts/' + postId + '?authorToken=' + encodeURIComponent(token), { method: 'DELETE' })
          .then(function () {
            if (editingPostId === postId) cancelEditMode();
            loadPosts();
          })
          .catch(function (e) { alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + e.message); });
      }

      btnSubmit.addEventListener('click', function () {
        var html = editor.innerHTML.trim().replace(/^<p><br><\/p>$/i, '').replace(/<p><br><\/p>$/i, '');
        if (!html) return;
        addPost(html);
      });

      btnSaveEdit.addEventListener('click', saveEdit);
      btnCancelEdit.addEventListener('click', cancelEditMode);

      function renderPosts(posts) {
        var myToken = getSessionToken();
        if (!posts || posts.length === 0) {
          postsEl.innerHTML = '<p class="empty-msg">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô ‚Äî ‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</p>';
          return;
        }
        postsEl.innerHTML = posts.map(function (p) {
          var timeStr = new Date(p.at).toLocaleString('th-TH', { dateStyle: 'short', timeStyle: 'short' });
          var meta = '‡πÇ‡∏û‡∏™‡πÄ‡∏°‡∏∑‡πà‡∏≠ ' + timeStr;
          if (p.editedAt) meta += ' (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏°‡∏∑‡πà‡∏≠ ' + new Date(p.editedAt).toLocaleString('th-TH', { dateStyle: 'short', timeStyle: 'short' }) + ')';
          var isMine = p.authorToken && p.authorToken === myToken;
          var actionsHtml = isMine
            ? '<div class="post-actions"><button type="button" class="post-btn edit-btn" data-id="' + p.id + '">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button type="button" class="post-btn del-btn" data-id="' + p.id + '">‡∏•‡∏ö</button></div>'
            : '';
          var likeCls = (p.liked ? ' like-btn active' : ' like-btn');
          var loveCls = (p.loved ? ' love-btn active' : ' love-btn');
          var reactionsHtml = '<div class="post-reactions">' +
            '<button type="button" class="react-btn' + likeCls + '" data-id="' + p.id + '" title="Like">üëç Like <span>' + (p.likes || 0) + '</span></button>' +
            '<button type="button" class="react-btn' + loveCls + '" data-id="' + p.id + '" title="Love">‚ù§Ô∏è Love <span>' + (p.loves || 0) + '</span></button>' +
            '</div>';
          return (
            '<div class="post" data-id="' + p.id + '">' +
              '<div class="post-content">' + p.content + '</div>' +
              '<div class="post-meta">' + meta + '</div>' +
              actionsHtml +
              reactionsHtml +
            '</div>'
          );
        }).join('');

        postsEl.querySelectorAll('.edit-btn').forEach(function (btn) {
          btn.addEventListener('click', function () { startEditMode(this.dataset.id, posts); });
        });
        postsEl.querySelectorAll('.del-btn').forEach(function (btn) {
          btn.addEventListener('click', function () { deletePost(this.dataset.id); });
        });
        postsEl.querySelectorAll('.react-btn.like-btn').forEach(function (btn) {
          btn.addEventListener('click', function () { toggleLike(this.dataset.id); });
        });
        postsEl.querySelectorAll('.react-btn.love-btn').forEach(function (btn) {
          btn.addEventListener('click', function () { toggleLove(this.dataset.id); });
        });
      }

      function loadPosts() {
        var token = getSessionToken();
        api('/api/posts?token=' + encodeURIComponent(token))
          .then(function (data) {
            renderPosts(data.posts || []);
          })
          .catch(function (e) {
            postsEl.innerHTML = '<p class="load-err">‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ' + e.message + '</p>';
          });
      }

      function toggleLike(postId) {
        var token = getSessionToken();
        api('/api/posts/' + postId + '/like', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ authorToken: token })
        }).then(function () { loadPosts(); }).catch(function (e) { alert('‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + e.message); });
      }

      function toggleLove(postId) {
        var token = getSessionToken();
        api('/api/posts/' + postId + '/love', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ authorToken: token })
        }).then(function () { loadPosts(); }).catch(function (e) { alert('‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + e.message); });
      }

      document.getElementById('btnClear').addEventListener('click', function () {
        var secret = document.getElementById('clearSecret').value.trim();
        if (!secret) { alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'); return; }
        api('/api/clear', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ secret: secret })
        }).then(function () {
          alert('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà');
          location.reload();
        }).catch(function (e) {
          alert('‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (e.message || '‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á CLEAR_SECRET'));
        });
      });

      loadPosts();
    })();
  </script>
</body>
</html>
